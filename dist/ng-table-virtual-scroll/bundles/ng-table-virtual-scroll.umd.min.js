!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/cdk/scrolling"),require("rxjs/operators"),require("rxjs"),require("@angular/material/table")):"function"==typeof define&&define.amd?define("ng-table-virtual-scroll",["exports","@angular/core","@angular/cdk/scrolling","rxjs/operators","rxjs","@angular/material/table"],e):e((t=t||self)["ng-table-virtual-scroll"]={},t.ng.core,t.ng.cdk.scrolling,t.rxjs.operators,t.rxjs,t.ng.material.table)}(this,(function(t,e,r,n,i,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function s(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,a=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o}var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype._updateChangeSubscription=function(){var t=this;this.initRenderedRangeStream();var e=this._sort,r=this._paginator,a=this._internalPageChanges,o=this._filter,u=this._renderData,c=e?i.merge(e.sortChange,e.initialized):i.of(null),h=r?i.merge(r.page,a,r.initialized):i.of(null),l=this._data,f=i.combineLatest([l,o]).pipe(n.map((function(e){var r=s(e,1)[0];return t._filterData(r)}))),p=i.combineLatest([f,c]).pipe(n.map((function(e){var r=s(e,1)[0];return t._orderData(r)}))),d=i.combineLatest([p,h]).pipe(n.map((function(e){var r=s(e,1)[0];return t._pageData(r)}))),g=i.combineLatest([d,this.renderedRangeStream.asObservable()]).pipe(n.map((function(t){var e=s(t,2),r=e[0],n=e[1],i=n.start,a=n.end;return null==i||null==a?r:r.slice(i,a)})));this._renderChangesSubscription.unsubscribe(),this._renderChangesSubscription=g.subscribe((function(t){return u.next(t)}))},e.prototype.initRenderedRangeStream=function(){this.renderedRangeStream||(this.renderedRangeStream=new i.Subject)},e}(a.MatTableDataSource),c=function(){function t(){this.indexChange=new i.Subject,this.stickyChange=new i.Subject,this.renderedRangeStream=new i.BehaviorSubject({start:null,end:null}),this.scrolledIndexChange=this.indexChange.pipe(n.distinctUntilChanged()),this._dataLength=0}return Object.defineProperty(t.prototype,"dataLength",{get:function(){return this._dataLength},set:function(t){this._dataLength=t,this.onDataLengthChanged()},enumerable:!0,configurable:!0}),t.prototype.attach=function(t){this.viewport=t,this.viewport.renderedRangeStream.subscribe(this.renderedRangeStream),this.onDataLengthChanged(),this.updateContent()},t.prototype.detach=function(){},t.prototype.onContentScrolled=function(){this.updateContent()},t.prototype.onDataLengthChanged=function(){this.viewport&&this.viewport.setTotalContentSize(this.dataLength*this.rowHeight+this.headerHeight)},t.prototype.onContentRendered=function(){},t.prototype.onRenderedOffsetChanged=function(){},t.prototype.scrollToIndex=function(t,e){},t.prototype.setConfig=function(t){var e=t.rowHeight,r=t.headerHeight,n=t.bufferMultiplier;this.rowHeight!==e&&this.headerHeight!==r&&this.bufferMultiplier!==n&&(this.rowHeight=e,this.headerHeight=r,this.bufferMultiplier=n,this.updateContent())},t.prototype.updateContent=function(){if(this.viewport&&this.rowHeight){var t=this.viewport.measureScrollOffset(),e=Math.ceil(this.viewport.getViewportSize()/this.rowHeight),r=Math.max(t-this.headerHeight,0),n=Math.ceil(e*this.bufferMultiplier),i=Math.round(r/this.rowHeight),a=Math.max(0,i),o=Math.max(0,a-n),s=Math.min(this.dataLength,a+e+n),u=o*this.rowHeight;this.viewport.setRenderedContentOffset(u),this.viewport.setRenderedRange({start:o,end:s}),this.indexChange.next(a),this.stickyChange.next(u)}},t.ɵfac=function(e){return new(e||t)},t.ɵprov=e["ɵɵdefineInjectable"]({token:t,factory:t.ɵfac}),t}();function h(t){return t.scrollStrategy}var l=48,f=56,p=.7,d=function(){function t(t){this.zone=t,this.alive=!0,this.rowHeight=l,this.headerHeight=f,this.bufferMultiplier=p,this.scrollStrategy=new c,this.dataSourceChanges=new i.Subject}return t.prototype.ngOnDestroy=function(){this.alive=!1,this.dataSourceChanges.complete()},t.prototype.isAlive=function(){var t=this;return function(){return t.alive}},t.prototype.isStickyEnabled=function(){return!!this.scrollStrategy.viewport&&this.table._headerRowDefs.map((function(t){return t.sticky})).reduce((function(t,e){return t&&e}),!0)},t.prototype.ngAfterContentInit=function(){var t=this,e=this.table._switchDataSource;this.table._switchDataSource=function(r){e.call(t.table,r),t.connectDataSource(r)},this.connectDataSource(this.table.dataSource),this.scrollStrategy.stickyChange.pipe(n.filter((function(){return t.isStickyEnabled()})),n.takeWhile(this.isAlive())).subscribe((function(e){t.setSticky(e)}))},t.prototype.connectDataSource=function(t){var e=this;if(this.dataSourceChanges.next(),!(t instanceof u))throw new Error("[tvsItemSize] requires TableVirtualScrollDataSource be set as [dataSource] of [mat-table]");this.scrollStrategy.renderedRangeStream.pipe(n.takeUntil(this.dataSourceChanges),n.takeWhile(this.isAlive())).subscribe((function(r){e.zone.run((function(){t.renderedRangeStream.next(r)}))})),t.connect().pipe(n.map((function(){return t.data.length})),n.distinctUntilChanged(),n.takeUntil(this.dataSourceChanges),n.takeWhile(this.isAlive())).subscribe((function(t){e.scrollStrategy.dataLength=t}))},t.prototype.ngOnChanges=function(){var t={rowHeight:+this.rowHeight||l,headerHeight:+this.headerHeight||f,bufferMultiplier:+this.bufferMultiplier||p};this.scrollStrategy.setConfig(t)},t.prototype.setSticky=function(t){var e="-"+t+"px";this.scrollStrategy.viewport.elementRef.nativeElement.querySelectorAll("th").forEach((function(t){t.style.top=e}))},t.ɵfac=function(r){return new(r||t)(e["ɵɵdirectiveInject"](e.NgZone))},t.ɵdir=e["ɵɵdefineDirective"]({type:t,selectors:[["cdk-virtual-scroll-viewport","tvsItemSize",""]],contentQueries:function(t,r,n){var i;(1&t&&e["ɵɵstaticContentQuery"](n,a.MatTable,!0),2&t)&&(e["ɵɵqueryRefresh"](i=e["ɵɵloadQuery"]())&&(r.table=i.first))},inputs:{rowHeight:["tvsItemSize","rowHeight"],headerHeight:"headerHeight",bufferMultiplier:"bufferMultiplier"},features:[e["ɵɵProvidersFeature"]([{provide:r.VIRTUAL_SCROLL_STRATEGY,useFactory:h,deps:[e.forwardRef((function(){return t}))]}]),e["ɵɵNgOnChangesFeature"]()]}),t}(),g=function(){function t(){}return t.ɵmod=e["ɵɵdefineNgModule"]({type:t}),t.ɵinj=e["ɵɵdefineInjector"]({factory:function(e){return new(e||t)},imports:[[]]}),t}();("undefined"==typeof ngJitMode||ngJitMode)&&e["ɵɵsetNgModuleScope"](g,{declarations:[d],exports:[d]}),t.FixedSizeTableVirtualScrollStrategy=c,t.TableItemSizeDirective=d,t.TableVirtualScrollDataSource=u,t.TableVirtualScrollModule=g,t._tableVirtualScrollDirectiveStrategyFactory=h,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-table-virtual-scroll.umd.min.js.map